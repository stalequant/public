<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hyperliquid and binance consolidated orderflow with stalegun demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: black;
            color: white;
        }
        #chart-container {
            width: 100%;
            height: 80%;
            position: relative;
            margin: 0 auto;
        }
        #watermark {
            position: absolute;
            font-size: 48px;
            opacity: 0.1;
            pointer-events: none;
        }
        #custom-legend {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 25px;
            cursor: pointer;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        .operation-form {

            margin-top: 20px;
        }
        .form-row {
	    color: white;
	    margin-left:20px;
            background-color: #111;
            display: flex;
            align-items: center;
        }


        .form-row label {
            display: inline-block;
            min-width: 100px;
        }
        input[type="number"] {
            width: 80px;        
	    background-color: #222;
            color: #fff;
            border: 1px solid #555;
            padding: 5px;
        }
        button {
            margin-right: 10px;
            padding: 10px 20px;
            border: none;
            background-color: #222;
            color: #ccc;
            font-size: .8em;
            cursor: pointer;
            transition: background-color 0.3s;
            text-transform: uppercase;
        }
        button.selected {
            background-color: #5a6d9e;
            color: #fff;
        }
        .button-group {
            display: flex;
            gap: 0px;
        }
        .button-group button {
            flex: 1;
        }
        .expandable {
            background-color: #222;
            padding: 10px;
            display: none;
            margin-top: 5px;
        }
        .expandable div {
            margin-bottom: 10px;
        }
        .expandable p {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 0;
        }
        .expandable button {
            margin: 2px;
            padding: 5px 10px;
        }
        .action-buttons {
            margin-top: 15px;
            text-decoration: line-through;
        }
        .action-buttons button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #5a6d9e;

        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #222;
        }
        .cancel-button {
            background-color: #722;
            color: #fff;
            padding: 5px 10px;
        }
        .cancel-all-button {
            background-color: #722;
            color: #fff;
            padding: 5px 10px;
            margin: 0;
        }
        .time-slider {
            width: 80%;
            margin: 5px 0;
        }

	.ui-autocomplete {
            background-color: #000;
            color: #fff;
            border: 1px solid #555;
            max-height: 200px;
            overflow-y: auto;
        }
        .ui-menu-item-wrapper {
            padding: 5px;
        }
        .ui-state-active {
            background-color: #5a6d9e;
            color: #fff;
        }
        #coinInput {
            width: 120px;
            background-color: #000;
            color: #fff;
            border: 1px solid #555;
            padding: 5px;
        }

    </style>
</head>
<body>
    <div class="operation-form">
        <div class="form-row">
            <label>stalegun aimed at </label>
 <input type="text" id="coinInput" placeholder="BTC" style="margin:10px;"></input>
</div></div>

    <div id="chart-container">
        <div id="watermark">stalequant.github.io/public/</div>
        <canvas id="coinChart"></canvas>
    </div>
    <div id="custom-legend"></div>

    <div class="operation-form">
        <div class="form-row">
 <label  >
order stalegun airstrike 
</label>
	</div>
        <div class="form-row">
            <label>what?</label>
            <div class="button-group">
                <button onclick="setOperation('buy', this)">BUY</button>
                <button onclick="setOperation('sell', this)">SELL</button>
            </div>
            <input type="number" id="quantity" placeholder="quantity" style="  margin-left: 10px;">
            <input type="number" id="dollars" placeholder="dollars" style="  margin-left: 10px;">     
        </div>
        </div>
        <div class="form-row">            <label>over:</label>
            <input type="range" id="timeInterval" min="0" max="100" value="50">
            <span id="timeIntervalValue">12 hours</span>
        </div>
        <div class="form-row ppp">
            <label>how?</label>
            <div class="button-group">
                <button onclick="setAdaptive('adaptive', this)">ADAPTIVE</button>
                <button onclick="setAdaptive('aggressive', this)">AGGRESSIVE</button>
                <button onclick="setAdaptive('price', this)">CHEAPEST</button>
                <button onclick="toggleDetails(this)">CUSTOM</button>
            </div>
        </div>

        <div id="details" class="expandable">
            <div>
                <p>taker:</p>
                <button onclick="toggleDetail(this)">HIDDEN TWAP</button>
                <button onclick="toggleDetail(this)">PSEUDO-VWAP</button>
                <button onclick="toggleDetail(this)">SNIPE LIMITS</button>
            </div>
            <div>
                <p>maker:</p>
                <button onclick="toggleDetail(this)">TOP OF THE BOOK</button>
                <button onclick="toggleDetail(this)">DEEP BOOK</button>
            </div>
            <div>
                <p>offchain:</p>
                <button onclick="toggleDetail(this)">MATCH WITH OTHER USERS</button>
                <button onclick="toggleDetail(this)">DARK POOLS</button>
                <button onclick="toggleDetail(this)">RFQ</button>
            </div>
        </div>
        <div class="form-row action-buttons">
            <button>DEMO IT</button>
            <button>DO IT</button>
<label>(canceled because i fear litiguous burgers)</label>
        </div>
    </div>

    <div class="operation-form">
 <div  class = "form form-row">
existing stalegun airstrikes 
</div> 
 <div  class = "form form-row" style="width:100%">
    <table>
        <tr>
            <th>operation</th>
            <th>done</th>
            <th>of</th>
            <th>after</th>
            <th>of</th>
            <th>at price</th>
            <th><button class="cancel-all-button" onclick="cancelAllOperations()">CANCEL ALL</button></th>
        </tr>
    </table>
</div>
</div>


    <script>
        // Get the coin from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
	const defaultCoins = ['BTC', 'ETH', 'TRX','XRP','DOGE','LINK','BCH','AVAX','MATIC','SOL', 'ADA', 'INJ'];

	// Get the coin from URL parameters or choose a random one from the list
	const coin = urlParams.get('coin') || 'BTC';

        const ctx = document.getElementById('coinChart').getContext('2d');
        const coinChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: `HL Trades`,
                        data: [],
                        borderColor: 'hsl(172,47%,51%)',
                        backgroundColor: 'hsl(172,47%,51%)',
                        borderWidth: 0,
                        pointStyle: 'circle',
                        pointRadius: 5, 
                        fill: false,
                        showLine: false
                    },
                    {
                        label: `HL Bid`,
                        data: [],
                        backgroundColor: 'hsla(172,47%,51%,0.2)',
                        borderWidth: 0,
                        fill: '+1',
                        stepped: true,
		        hidden: true,  // Start hidden

                        pointRadius: 0
                    },
                    {
                        label: `HL Ask`,
                        data: [],
                        backgroundColor: 'hsla(172,47%,51%,0.2)',
                        borderWidth: 0,
                        fill: '-1',
		        hidden: true,  // Start hidden
                        stepped: true,
                        pointRadius: 0,
                        display: false
                    },
                    {
                        label: `HL $5000 depth bid`,
                        data: [],
                        borderColor: 'hsl(172,47%,51%)',
                        borderWidth: 2,
                        fill: false,
                        
                        stepped: true,
                        pointRadius: 0
                    },
                    {
                        label: `HL $5000 depth ask`,
                        data: [],
                        borderColor: 'hsl(172,47%,51%)',
                        borderWidth: 2,
                        fill: false,
                        
                        stepped: true,
                        pointRadius: 0,
                        display: false
                    },
                    {
                        label: 'Binance Trades',
                        data: [],
                        borderColor: '#FCD535',
                        backgroundColor: '#FCD535',
                        borderWidth: 0,
                        pointStyle: 'circle',
                        pointRadius: 5,
                        
                        fill: false,
                        showLine: false
                    },
                    {
                        label: 'Binance Bid',
                        data: [],
                        backgroundColor: 'rgba(252, 213, 53, 0.2)',
                        borderWidth: 0,
                        fill: '+1',
		        hidden: true,  // Start hidden
                        stepped: true,
                        pointRadius: 0
                    },
                    {
                        label: 'Binance Ask',
                        data: [],
                        backgroundColor: 'rgba(252, 213, 53, 0.2)',
                        borderWidth: 0,
                        fill: '-1',
                        stepped: true,
		        hidden: true,  // Start hidden
                        pointRadius: 0,
                        display: false
                    },
                    {
                        label: 'Binance $5000 Bid',
                        data: [],
                        borderColor: '#FCD535',
                        borderWidth: 2,
                        
                        fill: false,
                        stepped: true,
                        pointRadius: 0
                    },
                    {
                        label: 'Binance $5000 Ask',
                        data: [],
                        borderColor: '#FCD535',
                        borderWidth: 2,
                        
                        stepped: true,
                        fill: false,
                        pointRadius: 0
                    },
                    {
                        label: 'Binance Spot Trades',
                        data: [],
                        borderColor: '#FC0535',
                        backgroundColor: '#FC0535',
                        borderWidth: 0,
                        pointStyle: 'circle',
                        pointRadius: 5,
                        
                        fill: false,
                        showLine: false
                    },
                    {
                        label: 'Binance Spot Bid',
                        data: [],
                        backgroundColor: 'rgba(252, 05, 53, 0.2)',
                        borderWidth: 0,
		        hidden: true,  // Start hidden
                        fill: '+1',
                        stepped: true,
                        pointRadius: 0
                    },
                    {
                        label: 'Binance Spot Ask',
                        data: [],
                        backgroundColor: 'rgba(252, 05, 53, 0.2)',
                        borderWidth: 0,
                        fill: '-1',
		        hidden: true,  // Start hidden
                        stepped: true,
                        pointRadius: 0,
                        display: false
                    },
                    {
                        label: 'Binance Spot $5000 Bid',
                        data: [],
                        borderColor: '#FC0535',
                        borderWidth: 2,
                        fill: false,
                        stepped: true,
                        pointRadius: 0
                    },
                    {
                        label: 'Binance Spot  $5000 Ask',
                        data: [],
                        borderColor: '#FC0535',
                        borderWidth: 2,
                        stepped: true,
                        fill: false,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                animation: false,
                scales: {
                    x: {
                        type: 'time',
                        grid: {
                            display: false,
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            display: false,
                            color: 'white'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'white'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        enabled: false
                    },
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Custom legend
        const legendItems = [
            { text: 'Hyperliquid', color: 'hsl(172,47%,51%)', style: 'square', datasets: [0, 1, 2, 3, 4] },
            { text: 'Binance', color: '#FCD535', style: 'square', datasets: [5, 6, 7, 8, 9] },
            { text: 'Binance Spot', color: '#FC0535', style: 'square', datasets: [10, 11, 12, 13, 14] },
            { text: 'Trades', color: 'white', pointStyle: 'circle', datasets: [0, 5, 10] },
            { text: 'Spread at $5000', color: 'white', style: 'line', datasets: [3, 4, 8, 9, 13, 14] },
            { text: 'Bid-Ask', color: 'rgba(255,255,255,0.5)', style: 'square', datasets: [1, 2, 6,7, 11, 12] }
        ];

        const legendContainer = document.getElementById('custom-legend');
        legendItems.forEach((item, index) => {
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            
            const color = document.createElement('div');
            color.className = 'legend-color';
            color.style.backgroundColor = item.color;
            if (item.style === 'line') {
                color.style.height = '2px';
                color.style.marginTop = '4px';
                color.style.marginBottom = '4px';
            } else if (item.style === 'circle') {
                color.style.borderRadius = '50%';
            }
            
            const text = document.createElement('span');
            text.className = 'legend-text';
            text.textContent = item.text;
            
            legendItem.appendChild(color);
            legendItem.appendChild(text);
            legendContainer.appendChild(legendItem);
            
    legendItem.onclick = function() {
        item.datasets.forEach(datasetIndex => {
                const meta = coinChart.getDatasetMeta(datasetIndex);
                meta.hidden = !meta.hidden;
        });
	coinChart.update();
    };
});

        const dataWindow = 30000; // 30 seconds of data
        let lastUpdateTime = Date.now();

        const wsHyperliquid = new WebSocket('wss://api.hyperliquid.xyz/ws');
        const wsBinanceBookTicker = new WebSocket(`wss://fstream.binance.com/ws/${coin.toLowerCase()}usdt@depth20@100ms`);
        const wsBinanceAggTrade = new WebSocket(`wss://fstream.binance.com/ws/${coin.toLowerCase()}usdt@aggTrade`);
        const wsBinanceSpotBookTicker = new WebSocket(`wss://stream.binance.com:443/ws/${coin.toLowerCase()}usdt@depth20@100ms`);
        const wsBinanceSpotAggTrade = new WebSocket(`wss://stream.binance.com:443/ws/${coin.toLowerCase()}usdt@aggTrade`);


        wsHyperliquid.onopen = function() {
            console.log('Hyperliquid WebSocket is connected');
            wsHyperliquid.send(JSON.stringify({
                "method": "subscribe",
                "subscription": { "type": "l2Book", "coin": coin }
            }));
            wsHyperliquid.send(JSON.stringify({
                "method": "subscribe",
                "subscription": { "type": "trades", "coin": coin }
            }));
        };

        wsHyperliquid.onmessage = function(event) {
            const message = JSON.parse(event.data);

            if (message.channel === "l2Book" && message.data.coin === coin) {
                const timestamp = parseFloat(message.data.time);
                const levels = message.data.levels;
		const reqLiq = 5000;
                if (levels && levels.length >= 2) {
                    const bid = parseFloat(levels[0][0].px);
                    const ask = parseFloat(levels[1][0].px);
                    let sum = 0;
                    let i = 0;
                    while (i < levels[0].length && sum < reqLiq) {
                        sum += parseFloat(levels[0][i].sz) * parseFloat(levels[0][i].px);
                        i++;
                    }
                    if (sum >= reqLiq) {
                        deepBid = parseFloat(levels[0][i-1].px);
                    } else if (levels[0].length > 0) {
                        deepBid = parseFloat(levels[0][levels[0].length - 1].px) / 1.01;
                    }
		    
                    let sumA = 0;
                    let iA = 0;
                    while (iA < levels[1].length && sumA < reqLiq) {
                        sumA += parseFloat(levels[1][iA].sz) * parseFloat(levels[1][i].px);
                        iA++;
                    }
                    if (sumA >= reqLiq) {
                        deepAsk = parseFloat(levels[1][iA-1].px);
                    } else if (levels[1].length > 0) {
                        deepAsk = parseFloat(levels[1][levels[1].length - 1].px) * 1.01;
                    }


                    addData(1, timestamp, bid);
                    addData(2, timestamp, ask);
                    addData(3, timestamp, deepBid);
                    addData(4, timestamp, deepAsk);
                }
            }

            if (message.channel === "trades" && message.data.length > 0) {
                message.data.forEach(trade => {
                    if (trade.coin === coin) {
                        const tradePrice = parseFloat(trade.px);
                        const timestamp = trade.time;
                        addData(0, timestamp, tradePrice);
                    }
                });
            }
        };

        wsHyperliquid.onerror = function(error) {
            console.error('Hyperliquid WebSocket Error: ', error);
        };

        wsHyperliquid.onclose = function() {
            console.log('Hyperliquid WebSocket is closed');
        };



        wsBinanceBookTicker.onopen = function() {
            console.log('Binance BookTicker WebSocket is connected');
        };

        wsBinanceBookTicker.onmessage = function(event) {
            const message = JSON.parse(event.data);

            if (message.e === "depthUpdate" && message.s === `${coin}USDT`) {	
		    const reqLiq = 5000;
                    const bid = parseFloat(message.b[0][0]);
                    const ask = parseFloat(message.a[0][0]);      
	            const timestamp = parseFloat(message.E);


                    let sum = 0;
                    let i = 0;
                    while (i < message.b.length && sum < reqLiq) {
                        sum += parseFloat(message.b[i][1]) * parseFloat(message.b[i][0]);
                        i++;
                    }
                    if (i <2 || sum >= reqLiq) {
                        deepBid = parseFloat(message.b[i-1][0]);
                    } else if (message.b.length > 0) {
                        deepBid = parseFloat(message.b[message.b.length - 1][0]) / 1.01;
                    }
		    
                    let sumA = 0;
                    let iA = 0;
                    while (iA < message.a.length && sumA < reqLiq) {
                        sumA += parseFloat(message.a[iA][1]) * parseFloat(message.a[iA][0]);
                        iA++;
                    }
                    if (iA <2 || sumA >= reqLiq) {
                        deepAsk = parseFloat(message.a[iA-1][0]);
                    } else if (message.a.length > 0) {
                        deepAsk = parseFloat(message.a[message.a.length - 1][0]) * 1.01;
                    }

                    addData(6, timestamp, bid); // Binance Bid
                    addData(7, timestamp, ask); // Binance Ask
                    addData(8, timestamp, deepBid); // Binance Bid
                    addData(9, timestamp, deepAsk); // Binance Ask


            }
        };

        wsBinanceAggTrade.onopen = function() {
            console.log('Binance AggTrade WebSocket is connected');
        };

        wsBinanceAggTrade.onmessage = function(event) {
            const message = JSON.parse(event.data);
            if (message.e === "aggTrade" && message.s === `${coin}USDT`) {
                const tradePrice = parseFloat(message.p);
                const timestamp = message.T;
                addData(5, timestamp, tradePrice); // Binance Trades
            }
        };

        wsBinanceBookTicker.onerror = function(error) {
            console.error('Binance BookTicker WebSocket Error: ', error);
        };

        wsBinanceBookTicker.onclose = function() {
            console.log('Binance BookTicker WebSocket is closed');
        };

        wsBinanceAggTrade.onerror = function(error) {
            console.error('Binance AggTrade WebSocket Error: ', error);
        };

        wsBinanceAggTrade.onclose = function() {
            console.log('Binance AggTrade WebSocket is closed');
        };





        wsBinanceSpotBookTicker.onopen = function() {
            console.log('BinanceSpot BookTicker WebSocket is connected');
        };

        wsBinanceSpotBookTicker.onmessage = function(event) {
            const message = JSON.parse(event.data);
            const currentTime = Date.now();
		    const reqLiq = 5000;
                    const bid = parseFloat(message.bids[0][0]);
                    const ask = parseFloat(message.asks[0][0]);      
	            const timestamp = parseFloat(message.E);


                    let sum = 0;
                    let i = 0;
                    while (i < message.bids.length && sum < reqLiq) {
                        sum += parseFloat(message.bids[i][1]) * parseFloat(message.bids[i][0]);
                        i++;
                    }
                    if (i <2 || sum >= reqLiq) {
                        deepBid = parseFloat(message.bids[i-1][0]);
                    } else if (message.bids.length > 0) {
                        deepBid = parseFloat(message.bids[message.bids.length - 1][0]) / 1.01;
                    }
		    
                    let sumA = 0;
                    let iA = 0;
                    while (iA < message.asks.length && sumA < reqLiq) {
                        sumA += parseFloat(message.asks[iA][1]) * parseFloat(message.asks[iA][0]);
                        iA++;
                    }
                    if (iA <2 || sumA >= reqLiq) {
                        deepAsk = parseFloat(message.asks[iA-1][0]);
                    } else if (message.asks.length > 0) {
                        deepAsk = parseFloat(message.asks[message.asks.length - 1][0]) * 1.01;
                    }

                    addData(11, currentTime, bid); // BinanceSpot Bid
                    addData(12, currentTime, ask); // BinanceSpot Ask
                    addData(13, currentTime, deepBid); // BinanceSpot Bid
                    addData(14, currentTime, deepAsk); // BinanceSpot Ask



        };

        wsBinanceSpotAggTrade.onopen = function() {
            console.log('BinanceSpot AggTrade WebSocket is connected');
        };

        wsBinanceSpotAggTrade.onmessage = function(event) {
            const message = JSON.parse(event.data);
            if (message.e === "aggTrade" && message.s === `${coin}USDT`) {
                const tradePrice = parseFloat(message.p);
                const timestamp = message.T;
                addData(10, timestamp, tradePrice); // BinanceSpot Trades
            }
        };

        wsBinanceSpotBookTicker.onerror = function(error) {
            console.error('BinanceSpot BookTicker WebSocket Error: ', error);
        };

        wsBinanceSpotBookTicker.onclose = function() {
            console.log('BinanceSpot BookTicker WebSocket is closed');
        };

        wsBinanceSpotAggTrade.onerror = function(error) {
            console.error('BinanceSpot AggTrade WebSocket Error: ', error);
        };

        wsBinanceSpotAggTrade.onclose = function() {
            console.log('BinanceSpot AggTrade WebSocket is closed');
        };










        function addData(datasetIndex, time, value) {
            coinChart.data.datasets[datasetIndex].data.push({x: time, y: value});
        }

        function updateChart(currentTime) {
            // Remove old data points
            coinChart.data.datasets.forEach(dataset => {
                dataset.data = dataset.data.filter(point => point.x > currentTime - dataWindow*1.5);
            });

            // Update x-axis range
            coinChart.options.scales.x.min = currentTime - dataWindow;
            coinChart.options.scales.x.max = currentTime;

            coinChart.update('none');
        }

        // Smooth scrolling update loop
        function smoothScroll() {
            const currentTime = Date.now();
            const elapsed = currentTime - lastUpdateTime;
            lastUpdateTime = currentTime;

            // Move all data points to the left
            coinChart.data.datasets.forEach(dataset => {
                dataset.data.forEach(point => {
                    point.x -= elapsed;
                });
            });

            updateChart(currentTime);
            requestAnimationFrame(smoothScroll);
        }

        smoothScroll(); // Start the smooth scrolling




        function toggleDetails(button) {
            const details = document.getElementById('details');
            if (details.style.display === 'none' || details.style.display === '') {
                details.style.display = 'block';
                button.classList.add('selected');
            } else {
                details.style.display = 'none';
                button.classList.remove('selected');
            }
        }

        function setOperation(op, button) {
            console.log('Operation set to:', op);
            clearSelection(button.parentNode);
            button.classList.add('selected');
        }

        function setAdaptive(type, button) {
            console.log('Adaptive type set to:', type);
            clearSelection(button.parentNode);
            button.classList.add('selected');
            document.getElementById('details').style.display = 'none';
        }

        function toggleDetail(button) {
            button.classList.toggle('selected');
        }

        function clearSelection(parent) {
            parent.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
        }

        function cancelOperation(operationId) {
            console.log('Canceling operation:', operationId);
            // Add logic to cancel the specific operation
        }

        function cancelAllOperations() {
            console.log('Canceling all operations');
            // Add logic to cancel all operations
        }

        const timeInterval = document.getElementById('timeInterval');
        const timeIntervalValue = document.getElementById('timeIntervalValue');
        
        function logSlider(position) {
            // position will be between 0 and 100
            const minp = 0;
            const maxp = 100;

            // The result should be between 1 minute and 1 day (in minutes)
            const minv = Math.log(10);
            const maxv = Math.log(1440*7);

            // calculate adjustment factor
            const scale = (maxv - minv) / (maxp - minp);

            return Math.exp(minv + scale * (position - minp));
        }

        function formatTime(minutes) {
            if (minutes < 60) {
                return Math.round(minutes) + ' minutes';
            } else if (minutes < 1440) {
                return (minutes / 60).toFixed(1) + ' hours';
            } else {              
                return (minutes / 60/24).toFixed(1) + ' days';
            }
        }

        timeInterval.addEventListener('input', function() {
            const logValue = logSlider(this.value);
            timeIntervalValue.textContent = formatTime(logValue);
        });

        // Initialize the slider value
        timeInterval.value = 60;
        timeInterval.dispatchEvent(new Event('input'));

        const coinParam = urlParams.get('coin') || 'BTC'; 
        const coins = ['SOL', 'DOGE', 'BTC', 'ETH', 'LINK', 'INJ', 'AVAX', 'MATIC', 'RENDER', 'TRX'];

        $(document).ready(function() {
            $('#coinInput').val(coinParam);
            
            $('#coinInput').autocomplete({
                source: coins,
                select: function(event, ui) {
                    window.location.href = '?coin=' + ui.item.value;
                }
            });
        });
    </script>
</body>
</html>
